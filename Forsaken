local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local window = Rayfield:CreateWindow({
    Name = "Forsaken - Alpha Hax",
    LoadingTitle = "Loading Assets..",
    LoadingSubtitle = "Created By Luxx",
    ConfigurationSaving = {
        Enabled = false,
        FileName = "Sirius"
    },
    KeySystem = true,
    KeySettings = {
        Title = "Luxx's Key System",
        Subtitle = "Enter Your Key",
        Note = "Rate The Features",
        FileName = "Sirius",
        SaveKey = false,
        Key = "2025"
    }
})

local generatorsTab = window:CreateTab("Generators")
local completeSection = generatorsTab:CreateSection("Complete")

local autoCompleteActive = false

local function getLocalPlayerModel()
    local playersFolder = workspace:FindFirstChild("Players")
    if not playersFolder then return nil end

    local survivorsFolder = playersFolder:FindFirstChild("Survivors")
    if not survivorsFolder then return nil end

    local localPlayerName = game.Players.LocalPlayer.Name

    for _, model in ipairs(survivorsFolder:GetChildren()) do
        if model:IsA("Model") and model:GetAttribute("Username") == localPlayerName then
            return model
        end
    end

    return nil
end

local function getNearestGenerator(playerModel)
    if not playerModel then return nil end

    local mapFolder = workspace:FindFirstChild("Map")
    if not mapFolder then return nil end

    local ingameFolder = mapFolder:FindFirstChild("Ingame")
    if not ingameFolder then return nil end

    local nearestGenerator = nil
    local shortestDistance = math.huge
    local playerPosition = playerModel:FindFirstChild("HumanoidRootPart") and playerModel.HumanoidRootPart.Position

    for _, generator in ipairs(ingameFolder:GetChildren()) do
        if generator:IsA("Model") and generator.Name == "Generator" then
            local generatorPosition = generator:GetModelCFrame().Position
            local distance = (generatorPosition - playerPosition).Magnitude

            if distance < shortestDistance then
                shortestDistance = distance
                nearestGenerator = generator
            end
        end
    end

    return nearestGenerator
end

local function autoCompleteGenerators()
    while autoCompleteActive do
        wait()
        local playerModel = getLocalPlayerModel()
        local playerGui = game.Players.LocalPlayer:FindFirstChild("PlayerGui")
        if not playerModel or not playerGui then continue end

        local puzzleUI = playerGui:FindFirstChild("PuzzleUI")
        local nearestGenerator = getNearestGenerator(playerModel)

        if nearestGenerator and puzzleUI and puzzleUI.Visible then
            local remotesFolder = nearestGenerator:FindFirstChild("Remotes")
            if remotesFolder then
                local remoteEvent = remotesFolder:FindFirstChild("RE")
                if remoteEvent then
                    remoteEvent:FireServer()
                    repeat wait() until not puzzleUI.Visible
                end
            end
        end
    end
end

local autoCompleteToggle = generatorsTab:CreateToggle({
    Name = "Auto Complete Generators",
    CurrentValue = false,
    SectionParent = completeSection,
    Callback = function(state)
        autoCompleteActive = state
        if state then
            Rayfield:Notify({
                Title = "Success!",
                Content = "Auto Complete Generators Enabled!"
            })
            autoCompleteGenerators()
        else
            Rayfield:Notify({
                Title = "Success!",
                Content = "Auto Complete Generators Disabled!"
            })
        end
    end
})

Rayfield:LoadConfiguration()
