local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local window = Rayfield:CreateWindow({
    Name = "Dandys World - Alpha Hax",
    LoadingTitle = "Loading Assets..",
    LoadingSubtitle = "Created By Luxx",
    ConfigurationSaving = {
        Enabled = false,
        FileName = "Sirius"
    },
    KeySystem = true,
    KeySettings = {
        Title = "Luxx's Key System",
        Subtitle = "Enter Your Key",
        Note = "Rate The Features",
        FileName = "Sirius",
        SaveKey = false,
        Key = "2025"
    }
})

local twistedsTab = window:CreateTab("Twisteds")
local twistedsSection = twistedsTab:CreateSection("Twisteds")

local highlightToggleEnabled = false

local function removeHighlights()
    local currentRoom = workspace:FindFirstChild("CurrentRoom")
    if currentRoom then
        for _, model in ipairs(currentRoom:GetChildren()) do
            if model:IsA("Model") then
                local monstersFolder = model:FindFirstChild("Monsters")
                if monstersFolder then
                    for _, monster in ipairs(monstersFolder:GetChildren()) do
                        if monster:IsA("Model") then
                            local highlight = monster:FindFirstChildOfClass("Highlight")
                            if highlight then
                                highlight:Destroy()
                            end
                        end
                    end
                end
            end
        end
    end
end

local highlightToggle = twistedsTab:CreateToggle({
    Name = "Highlight Twisteds (You Can Enable/Disable It)",
    SectionParent = twistedsSection,
    CurrentValue = false,
    Callback = function(value)
        highlightToggleEnabled = value

        if not value then
            highlightToggleEnabled = false
            removeHighlights()
            return
        end

        while highlightToggleEnabled do
            local currentRoom = workspace:FindFirstChild("CurrentRoom")
            if currentRoom then
                for _, model in ipairs(currentRoom:GetChildren()) do
                    if model:IsA("Model") then
                        local monstersFolder = model:FindFirstChild("Monsters")
                        if monstersFolder then
                            for _, monster in ipairs(monstersFolder:GetChildren()) do
                                if monster:IsA("Model") then
                                    if not monster:FindFirstChildOfClass("Highlight") then
                                        local highlight = Instance.new("Highlight")
                                        highlight.FillColor = Color3.fromRGB(255, 0, 0)
                                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                                        highlight.Parent = monster
                                    end
                                end
                            end
                        end
                    end
                end
            end
            wait()
        end
    end
})

local notifySection = twistedsTab:CreateSection("Notify")

local monitoring = false
local monitoringThreads = {}

local function startMonitoring()
    for _, t in ipairs(monitoringThreads) do
        if t and coroutine.status(t) ~= "dead" then
            coroutine.close(t)
        end
    end
    monitoringThreads = {}

    local success = pcall(function()
        local currentRoom = workspace:FindFirstChild("CurrentRoom")
        if not currentRoom then return end

        local model = currentRoom:FindFirstChildWhichIsA("Model")
        if not model then return end

        local monstersFolder = model:FindFirstChild("Monsters")
        if not monstersFolder then return end

        for _, monster in ipairs(monstersFolder:GetChildren()) do
            local chasingValue = monster:FindFirstChild("ChasingValue")
            if chasingValue and chasingValue:IsA("StringValue") then
                local lastState = chasingValue.Value

                local thread = coroutine.create(function()
                    while monitoring do
                        if chasingValue.Value ~= lastState then
                            if chasingValue.Value == LocalPlayer.Name then
                                Rayfield:Notify({
                                    Title = "Twisted Chasing Notifier",
                                    Content = monster.Name .. " is currently chasing you!",
                                    Duration = 6.5,
                                    Image = 4483362458,
                                })
                            elseif lastState == LocalPlayer.Name and chasingValue.Value == "" then
                                Rayfield:Notify({
                                    Title = "Twisted Chasing Notifier",
                                    Content = monster.Name .. " has stopped chasing you!",
                                    Duration = 6.5,
                                    Image = 4483362458,
                                })
                            end
                            lastState = chasingValue.Value
                        end
                        task.wait()
                    end
                end)
                coroutine.resume(thread)
                table.insert(monitoringThreads, thread)
            end
        end
    end)
end

twistedsTab:CreateToggle({
    Name = "Auto Notify Twisteds (When It Chases You)",
    CurrentValue = false,
    SectionParent = notifySection,
    Callback = function(Value)
        monitoring = Value
        if Value then
            startMonitoring()
        else
            for _, t in ipairs(monitoringThreads) do
                if t and coroutine.status(t) ~= "dead" then
                    coroutine.close(t)
                end
            end
            monitoringThreads = {}
        end
    end
})

Rayfield:LoadConfiguration()
